<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Demo of LightningOut with GitHubPage</title>
    <!-- Link to external CSS -->
    <link rel="stylesheet" href="https://jaden2245.github.io/lightningOut/mystyles.css">
    <script src="https://marriottintl--dttdev.sandbox.my.salesforce.com/lightning/lightning.out.js"></script>
</head>
<body>
    <header class="header">
        <h1>Marriott Case Management LightningOut POC</h1>
        <p>Experience the excellence of Marriott with our case management system.</p>
    </header>

    <main class="main-container">
        <section class="selection-container">
            <label for="idSelector">Choose a Case ID:</label>
            <select id="idSelector" class="dropdown">
                <option value="5007x00000NJBTyAAP">Case ID 1</option>
                <option value="5007x00000OmqbCAAR">Case ID 2</option>
                <option value="5007x00000NJWtOAAX">Case ID 3</option>
            </select>
            <button id="renderButton" class="primary-button">Render in LightningOut</button>
        </section>

        <section class="lightning-container">
            <div data-lightning-out="true"></div>
        </section>
    </main>

    <footer class="footer">
        <p>Â© 2025 Marriott International. All Rights Reserved.</p>
    </footer>

    <script>
        const appName = 'c:ShowTest';
        const componentName = 'c:caseViewEdit';
        const lightningEndpoint = 'https://marriottintl--dttdev.sandbox.lightning.force.com';
        const tokenUrl = 'https://marriottintl--dttdev.sandbox.my.salesforce.com/services/oauth2/token';
        const jwtToken = 'eyJhbGciOiJSUzI1NiJ9.eyJpc3MiOiIzTVZHOW5pM0MwYlVGamtwS3VXVUFtUEpiQlhmZDhxS1huYWdRTjdDR2tUOUVNZThxdFBUb1k1MW9FSldBeFgxRVZfX2w2WnFDZ1FvakloMzVMRF9qIiwic3ViIjoianVsaXVzLmFkZW5pcmFuQG1hcnJpb3R0LXNwLmNvbS5tZ3BxYS5kdHRkZXYiLCJhdWQiOiJodHRwczovL3Rlc3Quc2FsZXNmb3JjZS5jb20iLCJleHAiOiIxOTA5OTkwMjM2In0.pQNAACTHL8Uktat1K2oK_5ZukbH4UFiu571UD5yQhPwqcoJpT85hniyI6aGwtIzVQ-iPJXTMPvMrC45EjRAJm3yiWpRYoZY65gU2HXwTzi1wFtwEIp1EwmVpuirFIlY6YwIzrwPAXEFS1dIJeIekc6VVfeDbOYI70i6T4kA6VbDtsrF2254lQTOA3vrxiyrIkbmDZYWtf-vAJnIYxjKDbsecH3KbxiFX1t_ce9EEQrJjdY_NdkxGM11Z8AvkxIOWR7tm4sijxlv0V86NQsk7tBwODYf77kWPUZFzmy66spey-KY8H3S2ShjlItLD8I_hfsqMGUvhjzzWzfGp8Vd5rQ'; // Replace with your actual JWT assertion
        const targetElement = document.querySelector("[data-lightning-out]");

        async function fetchAccessToken() {
            const headers = {
                'Content-Type': 'application/x-www-form-urlencoded',
            };

            try {
                const response = await fetch(tokenUrl, {
                    method: 'POST',
                    headers: headers,
                    body: new URLSearchParams({
                        grant_type: 'urn:ietf:params:oauth:grant-type:jwt-bearer',
                        assertion: jwtToken,
                    }),
                });

                if (!response.ok) {
                    throw new Error(`Error fetching token: ${response.statusText}`);
                }

                const data = await response.json();
                return data.access_token;
            } catch (error) {
                console.error('Failed to fetch access token:', error);
            }
        }

        async function initializeLightningOut(recordId) {
            targetElement.innerHTML = ''; // Clear the previous component

            const accessToken = await fetchAccessToken();

            if (!accessToken) {
                console.error('Access token is not available. LightningOut cannot be initialized.');
                return;
            }

            console.log('Initializing LightningOut with recordId:', recordId);
            $Lightning.use(
                appName,
                function () {
                    $Lightning.createComponent(
                        componentName,
                        { recordId },
                        targetElement,
                        function (cmp) {
                            console.log('Lightning component created successfully with recordId:', recordId);
                        }
                    );
                },
                lightningEndpoint,
                accessToken
            );
        }

        document.getElementById('renderButton').addEventListener('click', () => {
            const selectedId = document.getElementById('idSelector').value;
            initializeLightningOut(selectedId);
        });
    </script>
</body>
</html>
