<html>
<title>Test 3</title>
<style>
    a {
        color: brown;
    }
</style>

<script src="https://marriottintl--dttdev.sandbox.my.salesforce.com/lightning/lightning.out.js"></script>

<div data-lightning-out="true"></div>

<script>
    const appName = 'c:ShowTest';
    const componentName = 'c:caseViewEdit';
    const lightningEndpoint = 'https://marriottintl--dttdev.sandbox.lightning.force.com';
    const targetElement = document.querySelector("[data-lightning-out]");

    // Configuration for JWT token request
    const tokenUrl = 'https://marriottintl--dttqa.sandbox.my.salesforce.com/services/oauth2/token';
    const jwtToken = 'eyJhbGciOiJSUzI1NiJ9.eyJpc3MiOiIzTVZHOWUwY1VyTDVsbTBaeG1tU0pOaGpKT29NRFhMd2d0dHlMRHZwdWRTVEZJdEgxbGV4Q0FDa2JCRmtUd2JUTFY5T3VCQjkwU2hKeFk1bFhXaFdSIiwic3ViIjoianVsaXVzLmFkZW5pcmFuQG1hcnJpb3R0LXNwLmNvbS5kdHRxYSIsImF1ZCI6Imh0dHBzOi8vdGVzdC5zYWxlc2ZvcmNlLmNvbSIsImV4cCI6IjE3Nzk5OTAyMzYifQ.w5V35Gvqqt5nfD5faWVPwRL_TUQc9e2USKNHEvSWjI42n8RCWHgcuMYVaaF2AXgYADGEuRGh9swN_dQV9JBoVJ8n4HCEXOmRlS70oE26DZZdfeWdTfTfkuuzo_LrNvufr6N5VQooil-0QfRTtTY9tx83tshe_RaGEEUuWFUBzSGigw_waoipdt_jEMsAFNS_WIXMKg9Ijso8EXi31iODNJk5nOXJUXAjH7AybOisHZjhqg6ssg7bXeQJasqiHezEvOsqFBmxMkQBBbSZWkm4nm4wrX-pylOYRtAUd-vnwxPAsMRougOt0ZYoNdNTt13O9JFtaIXv8JtL46I0AN5hTQ'; // Replace with your actual JWT assertion
    const headers = {
        'Content-Type': 'application/x-www-form-urlencoded',
    };

    async function fetchAccessToken() {
        try {
            const response = await fetch(tokenUrl, {
                method: 'POST',
                headers: headers,
                body: new URLSearchParams({
                    grant_type: 'urn:ietf:params:oauth:grant-type:jwt-bearer',
                    assertion: jwtToken,
                }),
            });

            if (!response.ok) {
                throw new Error(`Error fetching token: ${response.statusText}`);
            }

            const data = await response.json();
            return data.access_token;
        } catch (error) {
            console.error('Failed to fetch access token:', error);
        }
    }

    async function initializeLightningOut() {
        const accessToken = await fetchAccessToken();

        if (!accessToken) {
            console.error('Access token is not available. LightningOut cannot be initialized.');
            return;
        }

        console.log('Initializing LightningOut with fetched token...');
        $Lightning.use(
            appName,
            function () {
                $Lightning.createComponent(
                    componentName,
                    {},
                    targetElement,
                    function (cmp) {
                        console.log('Lightning component created successfully!');
                    }
                );
            },
            lightningEndpoint,
            accessToken
        );
    }

    // Initialize the application
    document.addEventListener('DOMContentLoaded', initializeLightningOut);
</script>
</html>
